				;file C:\Users\my asus\Desktop\Git_project\Touch-Slave\MAIN_PROGRAM_V103\MAIN_PROGRAM_V103.asm
				;1	
				;2	message '****************************************************************'
				;3	message '*PROJECT NAME :MAIN PROGRAM V103                               *'
				;4	message '*     VERSION :V103                                            *'
				;5	message '* ICE VERSION :                                                *'
				;6	message '*      DATE   :20160302                                        *'
				;7	message '*      REMARK :V103 add 33~36 key                              *'
				;8	message '****************************************************************'
				;9	                ;=INCLUDE REFERENCE FILE
				;10	                INCLUDE MAIN_PROGRAM_V103.INC
				;11	
				;12	                ;-PUBLIC LABEL
				;13	                PUBLIC  _LOAD_TKS_GLOBE_VARIES
				;14	                PUBLIC  _LOAD_HXT_REFERENCE
				;15	
				;16	CALL_   MACRO   FUNCTION
				;17	        ifdef   FUNCTION
				;18	                ifdef   PBP
				;19	                MOV     A,bank FUNCTION
				;20	                MOV     PBP,A
				;21	                endif
				;22	                CALL    FUNCTION
				;23	        endif
				;24	                ENDM
				;25	
				;26	EXTEND_FUNCTION_INITIAL MACRO
				;27	                CALL_   EXTEND_FUNCTION_1A_INITIAL
				;28	                CALL_   EXTEND_FUNCTION_1B_INITIAL
				;29	                CALL_   EXTEND_FUNCTION_1C_INITIAL
				;30	                CALL_   EXTEND_FUNCTION_1D_INITIAL
				;31	                CALL_   EXTEND_FUNCTION_1E_INITIAL
				;32	                CALL_   EXTEND_FUNCTION_1F_INITIAL
				;33	                CALL_   EXTEND_FUNCTION_1G_INITIAL
				;34	                CALL_   EXTEND_FUNCTION_1H_INITIAL
				;35	
				;36	                CALL_   EXTEND_FUNCTION_2A_INITIAL
				;37	                CALL_   EXTEND_FUNCTION_2B_INITIAL
				;38	                CALL_   EXTEND_FUNCTION_2C_INITIAL
				;39	                CALL_   EXTEND_FUNCTION_2D_INITIAL
				;40	                CALL_   EXTEND_FUNCTION_2E_INITIAL
				;41	                CALL_   EXTEND_FUNCTION_2F_INITIAL
				;42	                CALL_   EXTEND_FUNCTION_2G_INITIAL
				;43	                CALL_   EXTEND_FUNCTION_2H_INITIAL
				;44	                ENDM
				;45	
				;46	EXTEND_FUNCTION MACRO
				;47	                CALL_   EXTEND_FUNCTION_1A
				;48	                CALL_   EXTEND_FUNCTION_1B
				;49	                CALL_   EXTEND_FUNCTION_1C
				;50	                CALL_   EXTEND_FUNCTION_1D
				;51	                CALL_   EXTEND_FUNCTION_1E
				;52	                CALL_   EXTEND_FUNCTION_1F
				;53	                CALL_   EXTEND_FUNCTION_1G
				;54	                CALL_   EXTEND_FUNCTION_1H
				;55	
				;56	                CALL_   EXTEND_FUNCTION_2A
				;57	                CALL_   EXTEND_FUNCTION_2B
				;58	                CALL_   EXTEND_FUNCTION_2C
				;59	                CALL_   EXTEND_FUNCTION_2D
				;60	                CALL_   EXTEND_FUNCTION_2E
				;61	                CALL_   EXTEND_FUNCTION_2F
				;62	                CALL_   EXTEND_FUNCTION_2G
				;63	                CALL_   EXTEND_FUNCTION_2H
				;64	                ENDM
				;65	                ;==============
				;66	                ;=DATA SETCTION
				;67	                ;==============
				;68	MAIN_DATA       .SECTION          'DATA'
				;69	
				;70	ifndef  ESCpowerIDcheck
				;71	POR_ID          DB      2 DUP(?)
				;72	endif
				;73	
				;74	
				;75	
				;76	                ;==============
				;77	                ;=CODE SETCTION
				;78	                ;==============
				;79	PROGRAM_ENTRY   .SECTION  AT 000H 'CODE'
				;80	        ifdef   PBP
				;81	                CLR     PBP
				;82	                ifndef  ESCpowerIDcheck
				;83	                MOV     A,042H      ;ASCII = B
				;84	                endif
				;85	        else
				;86	                ;----------------
				;87	                ;-SET POR ID 1---
				;88	                ;----------------
				;89	                ifndef  ESCpowerIDcheck
				;90	                MOV     A,042H      ;ASCII = B
				PROGRAM_ENTRY:
				include BS83B12A-3.inc
0000	0F42	mov     a, 42H
				;91	                SNZ     TO
0001	3A8A	snz     TO
				;92	                MOV     POR_ID[0],A
0002	40C7	mov     POR_ID, a
				;93	                endif
				;94	        endif
				;95	                JMP     PROGRAM_RESET
0003	2CCE	jmp     PROGRAM_RESET
0004	0000	nop
0005	0000	nop
0006	0000	nop
0007	0000	nop
					----
					----
000A	0000	nop
000B	0000	nop
000C	0000	nop
000D	0000	nop
000E	0000	nop
000F	0000	nop
				;96	
				;97	                ;==============
				;98	                ;=MAIN PROGRAM=
				;99	                ;==============
				;100	MAIN_PROGRAM    .SECTION          'CODE'
				;101	
				;102	                ;;***********************
				;103	PROGRAM_RESET:  ;;* PROGRAM ENTRY *******
				;104	                ;;***********************
				;105	        ifdef   PBP
				;106	                ifndef  ESCpowerIDcheck
				;107	                SNZ     TO
				;108	                MOV     POR_ID[0],A
				;109	                endif
				;110	        endif
				;111	                ;----------------
				;112	                ;-SET POR ID 2---
				;113	                ;----------------
				;114	        ifndef  ESCpowerIDcheck
				;115	                MOV     A,053H      ;ASCII = S
				PROGRAM_RESET:
				MAIN_PROGRAM:
04CE	0F53	mov     a, 53H
				;116	                MOV     POR_ID[1],A
04CF	40C8	mov     POR_ID[1], a
				;117	        endif
				;118	
				;119	
				;120	                ;---------------------
				;121	                ;-MCU HARDWARE INITIAL
				;122	                ;---------------------
				;123	                MCU_HARDWARE_INITIAL
04D0	0F30	mov     a, 30H
04D1	008C	mov     CTRL, a
04D2	0F03	mov     a, 3H
04D3	008B	mov     SMOD, a
04D4	0F52	mov     a, 52H
04D5	009A	mov     WDTC, a
04D6	0F01	mov     a, 1H
04D7	0084	mov     BP, a
04D8	0F80	mov     a, 80H
04D9	24F5	call    CLEAR_RAM
04DA	1F04	clr     BP
04DB	0F60	mov     a, 60H
04DC	24F5	call    CLEAR_RAM
				;124	
				;125	                ;------------------------------
				;126	                ;-LOAD LIBRARY OPTION/THRESHOLD
				;127	                ;------------------------------
				;128	                CALL    _LOAD_TKS_GLOBE_VARIES
04DD	2502	call    _LOAD_HXT_REFERENCE
				;129	
				;130	                ;------------------------
				;131	                ;-EXTEND FUNCTION INITIAL
				;132	                ;------------------------
				;133	                EXTEND_FUNCTION_INITIAL
04DE	20A2	call    L00A2
04DF	2587	call    _USER_PROGRAM_INITIAL
				;134	
				;135	                ;;-----------------------
				;136	MAIN_LOOP:      ;;- MAIN PROGRAM LOOP ---
				;137	                ;;-----------------------
				;138	                CLR     WDT
				MAIN_LOOP:
04E0	0001	clr     wdt
				;139	                CLR     WDT1
04E1	0001	clr     wdt
				;140	                CLR     WDT2
04E2	0005	clr     wdt2
				;141	
				;142	                ;----------------
				;143	                ;-CHECK POR ID --
				;144	                ;----------------
				;145	        ifndef  ESCpowerIDcheck
				;146	                MOV     A,042H
04E3	0F42	mov     a, 42H
				;147	                XORM    A,POR_ID[0]
04E4	44C7	xorm    a, POR_ID
				;148	                MOV     A,053H
04E5	0F53	mov     a, 53H
				;149	                SZ      Z
04E6	3D0A	sz      Z
				;150	                XORM    A,POR_ID[1]
04E7	44C8	xorm    a, POR_ID[1]
				;151	                SNZ     Z
04E8	390A	snz     Z
				;152	                JMP     000H
04E9	2800	jmp     PROGRAM_ENTRY
				;153	        endif
				;154	                ;----------------------
				;155	                ;-RE INITIAL SYS. CLOCK
				;156	                ;----------------------
				;157	                RELOAD_SYS_CLOCK
04EA	0F30	mov     a, 30H
04EB	008C	mov     CTRL, a
04EC	0F03	mov     a, 3H
04ED	008B	mov     SMOD, a
				;158	                EXTEND_FUNCTION
04EE	2018	call    L0018
04EF	259A	call    _USER_PROGRAM
				;159	                ;----------------
				;160	                ;-SET POR ID  ---
				;161	                ;----------------
				;162	        ifndef  ESCpowerIDcheck
				;163	                MOV     A,042H      ;ASCII = B
04F0	0F42	mov     a, 42H
				;164	                MOV     POR_ID[0],A
04F1	40C7	mov     POR_ID, a
				;165	                MOV     A,053H      ;ASCII = S
04F2	0F53	mov     a, 53H
				;166	                MOV     POR_ID[1],A
04F3	40C8	mov     POR_ID[1], a
				;167	        endif
				;168	
				;169	                ;--------------------
				;170	WDT_WAKEUP:     ;-WDT WAKEUP FUNCTION
				;171	                ;--------------------
				;172	                if      PowerSave==1
				;173	                CALL_   _CHECK_KEY_WAKEUP
				;174	                endif
				;175	
				;176	                ifdef   PBP
				;177	                MOV     A,BANK MAIN_LOOP
				;178	                MOV     PBP,A
				;179	                endif
				;180	                JMP     MAIN_LOOP
				WDT_WAKEUP:
04F4	2CE0	jmp     MAIN_LOOP
				;181	
				;182	
				;183	
				;184	
				;185	
				;186	
				;187	
				;188	
				;189	
				;190	;;***********************************************************
				;191	;;*SUB. NAME:                                               *
				;192	;;*INPUT    :                                               *
				;193	;;*OUTPUT   :                                               *
				;194	;;*USED REG.:                                               *
				;195	;;*FUNCTION :                                               *
				;196	;;***********************************************************
				;197	CLEAR_RAM:
				;198	                MOV     MP1,A
				CLEAR_RAM:
04F5	0083	mov     MP1, a
				;199	        ifndef  ESCpowerIDcheck
				;200	            ifdef  BP
				;201	                ;-CHECK BANK
				;202	                SZ      BP
04F6	1084	sz      BP
				;203	                JMP     CLR_RAM
04F7	2CFE	jmp     CLR_RAM
				;204	            endif
				;205	                ;-CHECK POR_ID RAM
				;206	                MOV     A,OFFSET POR_ID
04F8	0FC7	mov     a, C7H
				;207	                XOR     A,MP1
04F9	0403	xor     a, MP1
				;208	                MOV     A,OFFSET POR_ID+1
04FA	0FC8	mov     a, C8H
				;209	                SNZ     Z
04FB	390A	snz     Z
				;210	                XOR     A,MP1
04FC	0403	xor     a, MP1
				;211	                SNZ     Z
04FD	390A	snz     Z
				;212	        endif
				;213	CLR_RAM:        ;-CLEAR RAM
				;214	                CLR     IAR1
				CLR_RAM:
04FE	1F02	clr     [02H]
				;215	                SIZA    MP1
04FF	1603	siza    MP1
				;216	                JMP     CLEAR_RAM
0500	2CF5	jmp     CLEAR_RAM
				;217	
				;218	                RET
0501	0003	ret
				;219	
				;220	
				;221	;;***********************************************************
				;222	;;*SUB. NAME:                                               *
				;223	;;*INPUT    :                                               *
				;224	;;*OUTPUT   :                                               *
				;225	;;*USED REG.:                                               *
				;226	;;*FUNCTION :                                               *
				;227	;;***********************************************************
				;228	_LOAD_TKS_GLOBE_VARIES:
				;229	_LOAD_HXT_REFERENCE:
				;230	                ;------------------------
				;231	                ;-SET TKS LIBRARY OPTION-
				;232	                ;------------------------
				;233	                MOV     A,GlobeOptionA
				_LOAD_HXT_REFERENCE:
				_LOAD_TKS_GLOBE_VARIES:
0502	0F87	mov     a, 87H
				;234	                MOV     _GLOBE_VARIES[0],A
0503	00E0	mov     __sima[57], a
				;235	                MOV     A,GlobeOptionB
0504	0F30	mov     a, 30H
				;236	                MOV     _GLOBE_VARIES[1],A
0505	00E1	mov     __sima[58], a
				;237	                MOV     A,GlobeOptionC
0506	0F98	mov     a, 98H
				;238	                MOV     _GLOBE_VARIES[2],A
0507	00E2	mov     __sima[59], a
				;239	
				;240	                ;--------------------------
				;241	                ;-SET TOUCH OR IO ATTRIBUTE
				;242	                ;--------------------------
				;243	                MOV     A,IO_TOUCH_ATTR&0FFH
0508	0FFF	mov     a, FFH
				;244	                MOV     _KEY_IO_SEL[0],A
0509	00FA	mov     __sima[83], a
				;245	                ;-IF OVER 2 TOUCH IP (8~16KEY)
				;246	                if      TouchKeyAmount > 8
				;247	                MOV     A,(IO_TOUCH_ATTR>>8)&0FFH
050A	0F0F	mov     a, FH
				;248	                MOV     _KEY_IO_SEL[1],A
050B	00FB	mov     __sima[84], a
				;249	                endif
				;250	                ;-IF OVER 4 TOUCH IP (17~24KEY)
				;251	                if      TouchKeyAmount > 16
				;252	                MOV     A,(IO_TOUCH_ATTR>>16)&0FFH
				;253	                MOV     _KEY_IO_SEL[2],A
				;254	                endif
				;255	                ;-IF OVER 6 TOUCH IP (25~32KEY)
				;256	                if      TouchKeyAmount > 24
				;257	                MOV     A,(IO_TOUCH_ATTR>>24)&0FFH
				;258	                MOV     _KEY_IO_SEL[3],A
				;259	                endif
				;260	
				;261	                ;-IF OVER 6 TOUCH IP (33~36KEY)
				;262	                if      TouchKeyAmount > 32
				;263	                MOV     A,IO_TOUCH_ATTR2
				;264	                MOV     _KEY_IO_SEL[4],A
				;265	                endif
				;266	
				;267	                ;------------------------
				;268	                ;-SET TOUCH KEY THRESHOLD
				;269	                ;------------------------
				;270	                ;-KEY1 THRESHOLD
				;271	                MOV     A,Key1Threshold
050C	0F0A	mov     a, AH
				;272	                MOV     _GLOBE_VARIES[3],A
050D	00E3	mov     __sima[60], a
				;273	
				;274	                if      TouchKeyAmount > 1
				;275	                ;-KEY2 THRESHOLD
				;276	                MOV     A,Key2Threshold
050E	0F0A	mov     a, AH
				;277	                MOV     _GLOBE_VARIES[4],A
050F	00E4	mov     __sima[61], a
				;278	                endif
				;279	
				;280	                if      TouchKeyAmount > 2
				;281	                ;-KEY3 THRESHOLD
				;282	                MOV     A,Key3Threshold
0510	0F0A	mov     a, AH
				;283	                MOV     _GLOBE_VARIES[5],A
0511	00E5	mov     __sima[62], a
				;284	                endif
				;285	
				;286	                if      TouchKeyAmount > 3
				;287	                ;-KEY4 THRESHOLD
				;288	                MOV     A,Key4Threshold
0512	0F0A	mov     a, AH
				;289	                MOV     _GLOBE_VARIES[6],A
0513	00E6	mov     __sima[63], a
				;290	                endif
				;291	
				;292	                if      TouchKeyAmount > 4
				;293	                ;-KEY5 THRESHOLD
				;294	                MOV     A,Key5Threshold
0514	0F0A	mov     a, AH
				;295	                MOV     _GLOBE_VARIES[7],A
0515	00E7	mov     __sima[64], a
				;296	                endif
				;297	
				;298	                if      TouchKeyAmount > 5
				;299	                ;-KEY6 THRESHOLD
				;300	                MOV     A,Key6Threshold
0516	0F0A	mov     a, AH
				;301	                MOV     _GLOBE_VARIES[8],A
0517	00E8	mov     __sima[65], a
				;302	                endif
				;303	
				;304	                if      TouchKeyAmount > 6
				;305	                ;-KEY7 THRESHOLD
				;306	                MOV     A,Key7Threshold
0518	0F0A	mov     a, AH
				;307	                MOV     _GLOBE_VARIES[9],A
0519	00E9	mov     __sima[66], a
				;308	                endif
				;309	
				;310	                if      TouchKeyAmount > 7
				;311	                ;-KEY8 THRESHOLD
				;312	                MOV     A,Key8Threshold
051A	0F0A	mov     a, AH
				;313	                MOV     _GLOBE_VARIES[10],A
051B	00EA	mov     __sima[67], a
				;314	                endif
				;315	
				;316	                if     TouchKeyAmount > 8
				;317	                ;-KEY9 THRESHOLD
				;318	                MOV     A,Key9Threshold
051C	0F0A	mov     a, AH
				;319	                MOV     _GLOBE_VARIES[11],A
051D	00EB	mov     __sima[68], a
				;320	                endif
				;321	
				;322	                if      TouchKeyAmount > 9
				;323	                ;-KEY10 THRESHOLD
				;324	                MOV     A,Key10Threshold
051E	0F0A	mov     a, AH
				;325	                MOV     _GLOBE_VARIES[12],A
051F	00EC	mov     __sima[69], a
				;326	                endif
				;327	
				;328	                if      TouchKeyAmount > 10
				;329	                ;-KEY11 THRESHOLD
				;330	                MOV     A,Key11Threshold
0520	0F0A	mov     a, AH
				;331	                MOV     _GLOBE_VARIES[13],A
0521	00ED	mov     __sima[70], a
				;332	                endif
				;333	
				;334	                if      TouchKeyAmount > 11
				;335	                ;-KEY12 THRESHOLD
				;336	                MOV     A,Key12Threshold
0522	0F0A	mov     a, AH
				;337	                MOV     _GLOBE_VARIES[14],A
0523	00EE	mov     __sima[71], a
				;338	                endif
				;339	
				;340	                if      TouchKeyAmount > 12
				;341	                ;-KEY13 THRESHOLD
				;342	                MOV     A,Key13Threshold
				;343	                MOV     _GLOBE_VARIES[15],A
				;344	                endif
				;345	
				;346	                if      TouchKeyAmount > 13
				;347	                ;-KEY14 THRESHOLD
				;348	                MOV     A,Key14Threshold
				;349	                MOV     _GLOBE_VARIES[16],A
				;350	                endif
				;351	
				;352	                if      TouchKeyAmount > 14
				;353	                ;-KEY15 THRESHOLD
				;354	                MOV     A,Key15Threshold
				;355	                MOV     _GLOBE_VARIES[17],A
				;356	                endif
				;357	
				;358	                if      TouchKeyAmount > 15
				;359	                ;-KEY16 THRESHOLD
				;360	                MOV     A,Key16Threshold
				;361	                MOV     _GLOBE_VARIES[18],A
				;362	                endif
				;363	
				;364	                if      TouchKeyAmount > 16
				;365	                ;-KEY17 THRESHOLD
				;366	                MOV     A,Key17Threshold
				;367	                MOV     _GLOBE_VARIES[19],A
				;368	                endif
				;369	
				;370	                if      TouchKeyAmount > 17
				;371	                ;-KEY18 THRESHOLD
				;372	                MOV     A,Key18Threshold
				;373	                MOV     _GLOBE_VARIES[20],A
				;374	                endif
				;375	
				;376	                if      TouchKeyAmount > 18
				;377	                ;-KEY19 THRESHOLD
				;378	                MOV     A,Key19Threshold
				;379	                MOV     _GLOBE_VARIES[21],A
				;380	                endif
				;381	
				;382	                if      TouchKeyAmount > 19
				;383	                ;-KEY20 THRESHOLD
				;384	                MOV     A,Key20Threshold
				;385	                MOV     _GLOBE_VARIES[22],A
				;386	                endif
				;387	
				;388	                if      TouchKeyAmount > 20
				;389	                ;-KEY17 THRESHOLD
				;390	                MOV     A,Key21Threshold
				;391	                MOV     _GLOBE_VARIES[23],A
				;392	                endif
				;393	
				;394	                if      TouchKeyAmount > 21
				;395	                ;-KEY18 THRESHOLD
				;396	                MOV     A,Key22Threshold
				;397	                MOV     _GLOBE_VARIES[24],A
				;398	                endif
				;399	
				;400	                if      TouchKeyAmount > 22
				;401	                ;-KEY19 THRESHOLD
				;402	                MOV     A,Key23Threshold
				;403	                MOV     _GLOBE_VARIES[25],A
				;404	                endif
				;405	
				;406	                if      TouchKeyAmount > 23
				;407	                ;-KEY20 THRESHOLD
				;408	                MOV     A,Key24Threshold
				;409	                MOV     _GLOBE_VARIES[26],A
				;410	                endif
				;411	
				;412	                if      TouchKeyAmount > 24
				;413	                ;-KEY17 THRESHOLD
				;414	                MOV     A,Key25Threshold
				;415	                MOV     _GLOBE_VARIES[27],A
				;416	                endif
				;417	
				;418	                if      TouchKeyAmount > 25
				;419	                ;-KEY18 THRESHOLD
				;420	                MOV     A,Key26Threshold
				;421	                MOV     _GLOBE_VARIES[28],A
				;422	                endif
				;423	
				;424	                if      TouchKeyAmount > 26
				;425	                ;-KEY19 THRESHOLD
				;426	                MOV     A,Key27Threshold
				;427	                MOV     _GLOBE_VARIES[29],A
				;428	                endif
				;429	
				;430	                if      TouchKeyAmount > 27
				;431	                ;-KEY20 THRESHOLD
				;432	                MOV     A,Key28Threshold
				;433	                MOV     _GLOBE_VARIES[30],A
				;434	                endif
				;435	
				;436	                if      TouchKeyAmount > 28
				;437	                ;-KEY29 THRESHOLD
				;438	                MOV     A,Key29Threshold
				;439	                MOV     _GLOBE_VARIES[31],A
				;440	                endif
				;441	
				;442	                if      TouchKeyAmount > 29
				;443	                ;-KEY30 THRESHOLD
				;444	                MOV     A,Key30Threshold
				;445	                MOV     _GLOBE_VARIES[32],A
				;446	                endif
				;447	
				;448	                if      TouchKeyAmount > 30
				;449	                ;-KEY31 THRESHOLD
				;450	                MOV     A,Key31Threshold
				;451	                MOV     _GLOBE_VARIES[33],A
				;452	                endif
				;453	
				;454	                if      TouchKeyAmount > 31
				;455	                ;-KEY32 THRESHOLD
				;456	                MOV     A,Key32Threshold
				;457	                MOV     _GLOBE_VARIES[34],A
				;458	                endif
				;459	
				;460	                if      TouchKeyAmount > 32
				;461	                ;-KEY33 THRESHOLD
				;462	                MOV     A,Key33Threshold
				;463	                MOV     _GLOBE_VARIES[35],A
				;464	                endif
				;465	
				;466	                if      TouchKeyAmount > 33
				;467	                ;-KEY34 THRESHOLD
				;468	                MOV     A,Key34Threshold
				;469	                MOV     _GLOBE_VARIES[36],A
				;470	                endif
				;471	
				;472	                if      TouchKeyAmount > 34
				;473	                ;-KEY35 THRESHOLD
				;474	                MOV     A,Key35Threshold
				;475	                MOV     _GLOBE_VARIES[37],A
				;476	                endif
				;477	
				;478	                if      TouchKeyAmount > 35
				;479	                ;-KEY36 THRESHOLD
				;480	                MOV     A,Key36Threshold
				;481	                MOV     _GLOBE_VARIES[38],A
				;482	                endif
				;483	
				;484	
				;485	                RET
0524	0003	ret
0525	B0A0	dc	0B0A0H
0526	D0C0	dc	0D0C0H
0527	F0E0	dc	0F0E0H
0528	0C03	xor     a, 3H
0529	0202	sub     a, [02H]
052A	0202	sub     a, [02H]
052B	184E	rla     TKM116DL
052C	0028	dc	00028H
				;486	
				;487	
				;488	
				;489	
				;490	                END
				;491	
				;492	
				;493	
				;file C:\Users\my asus\Desktop\Git_project\Touch-Slave\USER_PROGRAM\USER_PROGRAM.C
				;1	#include    "USER_PROGRAM.H"         
				;2	#include    "TOUCH_SLAVE_CONF.H"  
				;3	
				;4	#if	 (USE_MCU_TYPE == BS83B08A)
				;5		//I2C size
				;6		#define I2C_MAXNUM		8
				;7		//page size
				;8		const u8 IC_PAGE_SIZS[]={3,8,1,2,1,2};
				;9	
				;10	#elif (USE_MCU_TYPE == BS83B12A)
				;11		//I2C size
				;12		#define I2C_MAXNUM		12
				;13		//page size
				;14		const u8 IC_PAGE_SIZS[]={3,12,2,2,2,2};
				;15	
				;16	#elif (USE_MCU_TYPE == BS83B16A)
				;17		//I2C size
				;18		#define I2C_MAXNUM		16
				;19		//page size
				;20		const u8 IC_PAGE_SIZS[]={3,16,2,2,2,2};
				;21		
				;22	#endif
				;23	
				;24	//++++++++++++++++++++++MAIN PROGAM+++++++++++++++++++++++
				;25	
				;26	#define NTH 	0x0F
				;27	#define RESET 	0x0A
				;28	
				;29	const u8 IC_PAGE_HEAD[]={0xA0,0xB0,0xC0,0xD0,0xE0,0xF0};
				;30	
				;31	#define TRUE 	1
				;32	#define FALSE 	0
				;33	
				;34	_TKS_FLAGA_type      FLAG;
				;35	#define FLAG_I2C_Err    FLAG.bits.b0
				;36	#define FLAG_I2C_End    FLAG.bits.b1
				;37	//#define          	FLAG.bits.b2
				;38	//#define       	FLAG.bits.b3
				;39	//#define           FLAG.bits.b4
				;40	//#define           FLAG.bits.b5
				;41	//#define           FLAG.bits.b6
				;42	
				;43	struct I2C_LIST
				;44	{
				;45	//FOR HEAD
				;46		vu8 WordAddr;		
				;47		vu8 SUM;	
				;48		vu8 TxNum;
				;49		vu8 RxNum;
				;50		vu8 CheckSum;
				;51		vu8 CheckSum_Buf;		
				;52	}I2C;
				;53	
				;54	u8 I2C_Data[I2C_MAXNUM];
				;55	
				;56	u8 MCU_INF[3];
				;57	#define MCU_STATE 		MCU_INF[0]
				;58	#define MCU_SLEEP 		MCU_INF[1]
				;59	//#define MCU_WAKEUP 		MCU_INF[2]
				;60	//#define MCU_STATE 		MCU_INF[3]
				;61	//#define MCU_STATE 		MCU_INF[4]
				;62	
				;63	u8 SYS_INF[3];
				;64	#define I2C_STATE 		SYS_INF[0]
				;65	#define SYS_Version		SYS_INF[1]
				;66	//#define MCU_WAKEUP 		SYS_INF[2]
				;67	//#define MCU_STATE 		SYS_INF[3]
				;68	//#define MCU_STATE 		SYS_INF[4]
				;69	//u8 I2C_STATE;
				;70	
				;71	void DATA_LIST_UPDATA(void)
				;72	{
				;73		u8 *p;
				;74		
				;75		I2C.SUM = IC_PAGE_SIZS[I2C.WordAddr];//取量
				_DATA_LIST_UPDATA:
				_DATA_LIST_UPDATA:
052D	0F50	mov     a, 50H
052E	4340	add     a, I2C[0]
052F	0083	mov     MP1, a
0530	0F8A	mov     a, 8AH
0531	1F01	clr     MP0
0532	1381	adcm    a, MP0
0533	26EF	call    L06EF
0534	40C1	mov     I2C[1], a
				;76		
				;77	   	switch(I2C.WordAddr)//取的指
0535	4740	mov     a, I2C[0]
0536	40D3	mov     _DATA_LIST_UPDATA_2, a
0537	4753	mov     a, _DATA_LIST_UPDATA_2
0538	0A00	sub     a, 0H
0539	3D0A	sz      Z
053A	2D51	jmp     _L11
053B	0A01	sub     a, 1H
053C	3D0A	sz      Z
053D	2D56	jmp     _L9
053E	4753	mov     a, _DATA_LIST_UPDATA_2
053F	0A02	sub     a, 2H
0540	3D0A	sz      Z
0541	2D4B	jmp     _L5
0542	4753	mov     a, _DATA_LIST_UPDATA_2
0543	0A03	sub     a, 3H
0544	390A	snz     Z
0545	2D50	jmp     _L10
				;78		{
				;79			case 0 :p = &GLOBE_VARIES[0];break;
				;80			case 1 :p = &GLOBE_VARIES[3];break;
				_L9:
0556	0F63	mov     a, 63H
0557	40CA	mov     rb, a
0558	0F00	mov     a, 0H
0559	40CB	mov     rc, a
				;81			case 2 :p = &KEY_IO_SEL[0];break;
				_L5:
054B	0F7A	mov     a, 7AH
054C	40CA	mov     rb, a
054D	0F00	mov     a, 0H
054E	40CB	mov     rc, a
054F	2D5A	jmp     _L4
				;82			case 3 :p = &MCU_STATE;break;
0546	0FB1	mov     a, B1H
0547	40CA	mov     rb, a
0548	0F00	mov     a, 0H
0549	40CB	mov     rc, a
054A	2D5A	jmp     _L4
				;83			default :p = &GLOBE_VARIES[0];I2C.SUM = 0;break;
				_L10:
0550	5F41	clr     I2C[1]
				_L11:
0551	0F60	mov     a, 60H
0552	40CA	mov     rb, a
0553	0F00	mov     a, 0H
0554	40CB	mov     rc, a
0555	2D5A	jmp     _L4
				;84		}
				;85		
				;86		
				;87		for(I2C.RxNum=0;I2C.RxNum<I2C.SUM;I2C.RxNum++)
				_L4:
055A	5F43	clr     I2C[3]
055B	2D6F	jmp     _L7
056E	54C3	inc     I2C[3]
				_L7:
056F	4743	mov     a, I2C[3]
0570	4241	sub     a, I2C[1]
0571	380A	snz     C
0572	2D5C	jmp     _L8
0573	0003	ret
				;88		{	
				;89			*(p+I2C.RxNum) = I2C_Data[I2C.RxNum];	//更新|控
				_L8:
055C	0FB4	mov     a, B4H
055D	4343	add     a, I2C[3]
055E	0083	mov     MP1, a
055F	0F00	mov     a, 0H
0560	1F01	clr     MP0
0561	1381	adcm    a, MP0
0562	26EF	call    L06EF
0563	40C9	mov     ra, a
0564	4743	mov     a, I2C[3]
0565	434A	add     a, rb
0566	0083	mov     MP1, a
0567	1F05	clr     ACC
0568	534B	adc     a, rc
0569	0081	mov     MP0, a
056A	0701	mov     a, MP0
056B	0084	mov     BP, a
056C	4749	mov     a, ra
056D	0082	mov     [02H], a
				;90		}	
				;91		
				;92	}
				;93	
				;94	//初始化I2C
				;95	void I2C_LIST_INIT(void)
				;96	{
				;97		I2C.WordAddr = 0x00;
				_I2C_LIST_INIT:
				_I2C_LIST_INIT:
0574	5F40	clr     I2C[0]
				;98		I2C.SUM = 0;	
0575	5F41	clr     I2C[1]
				;99		I2C.RxNum = 0;
0576	5F43	clr     I2C[3]
				;100		I2C.TxNum = 0;
0577	5F42	clr     I2C[2]
				;101		I2C.CheckSum = 0;
0578	5F44	clr     I2C[4]
				;102		I2C.CheckSum_Buf = 0;
0579	5F45	clr     I2C[5]
				;103		FLAG_I2C_End = FALSE;
057A	74C6	clr     FLAG[0].1
				;104		FLAG_I2C_Err = FALSE;
057B	7446	clr     FLAG[0].0
057C	0003	ret
				;105	}
				;106	
				;107	//初始化系y
				;108	void SYS_LIST_INIT(void)
				;109	{
				;110		MCU_STATE = NTH;
				_SYS_LIST_INIT:
				_SYS_LIST_INIT:
057D	0F0F	mov     a, FH
057E	40B1	mov     MCU_INF[0], a
				;111		MCU_SLEEP = SleepTime; // 3s 
057F	0F4E	mov     a, 4EH
0580	40B2	mov     MCU_INF[1], a
				;112		
				;113		I2C_STATE = NTH;
0581	0F0F	mov     a, FH
0582	40AE	mov     SYS_INF[0], a
				;114		SYS_Version = Version;
0583	0F18	mov     a, 18H
0584	40AF	mov     SYS_INF[1], a
				;115		FLAG_I2C_Err = TRUE;//使用通信e`功能初始化I2C
0585	7046	set     FLAG[0].0
0586	0003	ret
				;116	}
				;117	
				;118	//==============================================
				;119	void USER_PROGRAM_INITIAL()
				;120	{	
				;121	//	_wdtc = 0b10101100;	//wdt = 1s 
				;122		
				;123		_pawu = 0;		//0:禁止下降沿唤醒;   1:使能
				_USER_PROGRAM_INITIAL:
				_USER_PROGRAM_INITIAL:
0587	1F17	clr     PAWU
				;124		_papu = 0;		//0:禁止上拉;         1:使能上拉
0588	1F16	clr     PAPU
				;125		
				;126		_pa = 0x00;	
0589	1F14	clr     PA
				;127		_pac = 0xFF;		//0:输出;      		  1:输入
058A	1F95	set     PAC
				;128	
				;129	
				;130	#ifdef	USE_INT_PIN			 
				;131		MCU_INT = 1;		
058B	3094	set     PA1
				;132		MCU_INT_C = 0;	
058C	3495	clr     PAC1
				;133		
				;134	#endif 	
				;135		
				;136		
				;137	#ifdef	USE_WAKEUP_PIN		
				;138		MCU_WAKEUP_WU = 1;
058D	3217	set     PAWU4
				;139		MCU_WAKEUP_C = 1;	
058E	3215	set     PAC4
				;140	
				;141	#endif 
				;142		
				;143		
				;144	//配置定时器	
				;145	//	_tmrc = 0b00000111;//12Mhz,1/128
				;146	//	_tmr = 131;//256-156=100,1/12M*128=10.7us; 10.7us*100=1.07ms
				;147	//	_te = 1;	//定时/计数器中断控制位
				;148	//	_ton = 1;	//定时/计数器启动/停止控制位
				;149			
				;150	//配置IIC	
				;151	//	_papu0 = 1;  	//SDA
				;152	//	_papu2 = 1;  	//SCL
				;153	
				;154		_simc0 = 0b11000010;
058F	0FC2	mov     a, C2H
0590	00A4	mov     SIMC0, a
				;155		_sima = I2C_Address;//从机地址
0591	0F28	mov     a, 28H
0592	00A7	mov     SIMC2, a
				;156		
				;157	//I2C超时配置	
				;158		_i2ctoc = 0b10111111; //64ms
0593	0FBF	mov     a, BFH
0594	00A3	mov     I2CTOC, a
				;159		_simf = 0;
0595	360F	clr     SIMF
				;160		_sime = 1;	
0596	300F	set     SIME
				;161		
				;162		SYS_LIST_INIT();
0597	257D	call    _SYS_LIST_INIT
				;163	
				;164		_emi = 1;	//总中断控制位	
0598	300E	set     EMI
0599	0003	ret
				;165	}
				;166	
				;167	//==============================================
				;168	//**********************************************
				;169	//==============================================
				;170	void USER_PROGRAM()
				;171	{
				;172	
				;173	//--------------------------------------------------------------------	
				;174		GET_KEY_BITMAP();//更新按I值
				_USER_PROGRAM:
				_USER_PROGRAM:
059A	24AE	call    L04AE
				;175		
				;176		#ifndef	BS83B08A	
				;177		
				;178		//取使能的按I值
				;179		KEY_DATA[0] = KEY_DATA[0]&KEY_IO_SEL[0] ;
				;180		KEY_DATA[1] = KEY_DATA[1]&KEY_IO_SEL[1] ;	
				;181		//有按I按下INT低
				;182		 if(KEY_DATA[0] || KEY_DATA[1]) 
				;183		 {
				;184			MCU_INT = 0;
				;185			STANDBY_TIME = 0x7F;
				;186		 }
				;187	  	 else
				;188	  	 {
				;189		 	MCU_INT = 1;
				;190		 	
				;191	 		if(STANDBY_TIME <= MCU_SLEEP ) // 7E - 3*1000/63 
				;192	  	 	{
				;193	  	 		STANDBY_TIME = 0;
				;194	  	 	}
				;195	 	
				;196		 		
				;197	  	 }
				;198	  	 
				;199		#endif	
				;200		
				;201		#ifdef	BS83B08A
				;202		
				;203		//取使能的按I值
				;204		KEY_DATA[0] = KEY_DATA[0]&KEY_IO_SEL[0] ;
059B	077A	mov     a, __sima[83]
059C	067C	and     a, __sima[85]
059D	40C9	mov     ra, a
059E	4749	mov     a, ra
059F	00FC	mov     __sima[85], a
				;205		//有按I按下INT低
				;206		 if(KEY_DATA[0]) 
05A0	50C9	sz      ra
05A1	2DA3	jmp     _LI1
05A2	2DA7	jmp     _L17
				;207		 {
				;208			MCU_INT = 0;
				_LI1:
05A3	3494	clr     PA1
				;209			STANDBY_TIME = 0x7F;
05A4	0F7F	mov     a, 7FH
05A5	00F8	mov     __sima[81], a
05A6	2DAD	jmp     _L18
				;210		 }
				;211	  	 else
				;212	  	 {
				;213		 	MCU_INT = 1;
				_L17:
05A7	3094	set     PA1
				;214		 	
				;215	 		if(STANDBY_TIME <= MCU_SLEEP ) // 7E - 3*1000/63 
05A8	4732	mov     a, MCU_INF[1]
05A9	0278	sub     a, __sima[81]
05AA	380A	snz     C
05AB	2DAD	jmp     _L18
				;216	  	 	{
				;217	  	 		STANDBY_TIME = 0;
05AC	1F78	clr     __sima[81]
				;218	  	 	}
				;219	 	
				;220		 		
				;221	  	 }
				;222		#endif		
				;223	
				;224	
				;225		
				;226		if(FLAG_I2C_Err) // 通信e`，臀I2C
				_L18:
05AD	7846	snz     FLAG[0].0
05AE	2DB0	jmp     _L19
				;227		{
				;228			I2C_LIST_INIT();
05AF	2574	call    _I2C_LIST_INIT
				;229		}
				;230	//	----------------------------------------------------------------
				;231		if(FLAG_I2C_End)				//一帧数据接收完成标志
				_L19:
05B0	78C6	snz     FLAG[0].1
05B1	2DDB	jmp     _L16
				;232		{
				;233			//⒌刂忿DQ成a	
				;234			I2C.WordAddr >>= 4;
05B2	5140	swapa   I2C[0]
05B3	0E0F	and     a, FH
05B4	40C0	mov     I2C[0], a
				;235			I2C.WordAddr -= 0x0A;
05B5	0FF6	mov     a, F6H
05B6	43C0	addm    a, I2C[0]
				;236			//接收到的有效
				;237			I2C.RxNum -= 2;
05B7	0FFE	mov     a, FEH
05B8	43C3	addm    a, I2C[3]
				;238		
				;239			//先判 a是否榭的前四 ， 且有效量是否符合大小
				;240			if((I2C.WordAddr <= 3) && (I2C.RxNum == IC_PAGE_SIZS[I2C.WordAddr])) 
05B9	0F03	mov     a, 3H
05BA	4240	sub     a, I2C[0]
05BB	380A	snz     C
05BC	2DD9	jmp     _L21
05BD	0F50	mov     a, 50H
05BE	4340	add     a, I2C[0]
05BF	0083	mov     MP1, a
05C0	0F8A	mov     a, 8AH
05C1	1F01	clr     MP0
05C2	1381	adcm    a, MP0
05C3	26EF	call    L06EF
05C4	40C9	mov     ra, a
05C5	4743	mov     a, I2C[3]
05C6	4249	sub     a, ra
05C7	390A	snz     Z
05C8	2DD9	jmp     _L21
				;241			{	
				;242				I2C.CheckSum_Buf =~ I2C.CheckSum_Buf;//取反党龅
05C9	4145	cpla    I2C[5]
05CA	40C5	mov     I2C[5], a
				;243				
				;244				if( I2C.CheckSum == I2C.CheckSum_Buf  )//CCheckSum
05CB	4744	mov     a, I2C[4]
05CC	4245	sub     a, I2C[5]
05CD	390A	snz     Z
05CE	2DD9	jmp     _L21
				;245				{
				;246					I2C_STATE = TRUE; //入正_苏I
05CF	0F01	mov     a, 1H
05D0	40AE	mov     SYS_INF[0], a
				;247					
				;248					DATA_LIST_UPDATA();//更新|控值
05D1	252D	call    _DATA_LIST_UPDATA
				;249					
				;250					
				;251					if(MCU_STATE == RESET)// 系yO置，如果O置臀唬tR上臀
05D2	4731	mov     a, MCU_INF[0]
05D3	0A0A	sub     a, AH
05D4	390A	snz     Z
05D5	2DDA	jmp     _L23
				;252					{
				;253						MCU_INT = 0;
05D6	3494	clr     PA1
				;254						_wdtc = 0xFF;//MCU RESET //64MS
05D7	1F9A	set     WDTC
05D8	2DDA	jmp     _L23
				;255					}
				;256					
				;257					
				;258				}
				;259				else I2C_STATE = FALSE;	//入e`苏I					
				;260			}	
				;261			else I2C_STATE = FALSE;	//入e`苏I	
				_L21:
05D9	5F2E	clr     SYS_INF[0]
				;262				
				;263			FLAG_I2C_End = FALSE;
				_L23:
05DA	74C6	clr     FLAG[0].1
				_L16:
05DB	0003	ret
				;264		}	
				;265	//	----------------------------------------------------------------
				;266	}
				;267	
				;268	
				;269	
				;270	
				;271	void __attribute((interrupt(0x10))) IIC_ISR(void)
				;272	{ 
				@IIC_ISR_code .SECTION 'CODE'
0010	40CC	mov     r110, a
0011	0704	mov     a, BP
0012	40CD	mov     r210, a
0013	2DDC	jmp     _IIC_ISR
				@dummy16 .SECTION 'CODE'
					----
					----
					----
					----
				L0018:
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
				L00A2:
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
				L04AE:
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
					----
				_IIC_ISR:
				_IIC_ISR:
05DC	070A	mov     a, STATUS
05DD	40CE	mov     r310, a
05DE	0703	mov     a, MP1
05DF	40CF	mov     r410, a
05E0	0701	mov     a, MP0
05E1	40D0	mov     r510, a
				;273	 	vu8 data;	
				;274	 	
				;275	 	_simf = 0;		//清零标志位				
05E2	360F	clr     SIMF
				;276	 	if(_i2ctof)//_i2ctof=1:I2C通信超时
05E3	3B23	snz     I2CTOF
05E4	2DE9	jmp     L05E9
				;277	 	{
				;278	 		_i2ctoen = 1;
05E5	33A3	set     I2CTOEN
				;279	 		_i2ctof = 0;
05E6	3723	clr     I2CTOF
				;280	 		FLAG_I2C_Err = TRUE;
05E7	7046	set     FLAG[0].0
05E8	2EE4	jmp     L06E4
				;281	 	}
				;282	 	else 
				;283	 		{
				;284				if(_haas)//_haas=1:slave receive SLAVE_ADDR match							
				L05E9:
05E9	3B25	snz     HAAS
05EA	2E33	jmp     L0633
				;285				{
				;286					//地址匹配后，判断主机x位,主机是写从机还是读从机
				;287	
				;288					if(_srw)//srw=1:slave send data to master (frist data).
05EB	3925	snz     SRW
05EC	2E2A	jmp     L062A
				;289					{							
				;290						
				;291						if(I2C.WordAddr == 0x00)
05ED	50C0	sz      I2C[0]
05EE	2DF4	jmp     L05F4
				;292						{
				;293							I2C.SUM = IC_PAGE_SIZS[0];
05EF	0F03	mov     a, 3H
05F0	40C1	mov     I2C[1], a
				;294							I2C.TxNum = IC_PAGE_HEAD[0];
05F1	0FA0	mov     a, A0H
05F2	40C2	mov     I2C[2], a
				;295							I2C.CheckSum_Buf = 0;
05F3	5F45	clr     I2C[5]
				;296						}
				;297						
				;298							
				;299						switch(I2C.TxNum)
				L05F4:
05F4	4742	mov     a, I2C[2]
05F5	40D2	mov     data[1], a
05F6	4752	mov     a, data[1]
05F7	0AA0	sub     a, A0H
05F8	3D0A	sz      Z
05F9	2E11	jmp     L0611
05FA	0A10	sub     a, 10H
05FB	3D0A	sz      Z
05FC	2E14	jmp     L0614
05FD	4752	mov     a, data[1]
05FE	0AC0	sub     a, C0H
05FF	3D0A	sz      Z
0600	2E17	jmp     L0617
0601	0A10	sub     a, 10H
0602	3D0A	sz      Z
0603	2E1A	jmp     L061A
0604	4752	mov     a, data[1]
0605	0AE0	sub     a, E0H
0606	3D0A	sz      Z
0607	2E1D	jmp     L061D
0608	4752	mov     a, data[1]
0609	0AF0	sub     a, F0H
060A	390A	snz     Z
060B	2E20	jmp     L0620
				;300						{	
				;301							case 0xA0 :data = GLOBE_VARIES[0];break;
				L0611:
0611	0760	mov     a, __sima[57]
0612	40D1	mov     data[0], a
0613	2E22	jmp     L0622
				;302							case 0xB0 :data = GLOBE_VARIES[3];;break;
				L0614:
0614	0763	mov     a, __sima[60]
0615	40D1	mov     data[0], a
0616	2E22	jmp     L0622
				;303							case 0xC0 :data = KEY_IO_SEL[0];break;
				L0617:
0617	077A	mov     a, __sima[83]
0618	40D1	mov     data[0], a
0619	2E22	jmp     L0622
				;304							case 0xD0 :data = MCU_INF[0];break;
				L061A:
061A	4731	mov     a, MCU_INF[0]
061B	40D1	mov     data[0], a
061C	2E22	jmp     L0622
				;305							case 0xE0 :data = KEY_DATA[0];break;
				L061D:
061D	077C	mov     a, __sima[85]
061E	40D1	mov     data[0], a
061F	2E22	jmp     L0622
				;306							case 0xF0 :data =  SYS_INF[0]; SYS_INF[0] = NTH;break;
060C	472E	mov     a, SYS_INF[0]
060D	40D1	mov     data[0], a
060E	0F0F	mov     a, FH
060F	40AE	mov     SYS_INF[0], a
0610	2E22	jmp     L0622
				;307							default : data = 0xAA;;break;
				L0620:
0620	0FAA	mov     a, AAH
0621	40D1	mov     data[0], a
				;308						}
				;309						_htx = 1; //_htx=1:	
				L0622:
0622	3225	set     HTX
				;310						_simd = data;
0623	4751	mov     a, data[0]
0624	00A6	mov     SIMD, a
				;311						
				;312						I2C.CheckSum_Buf += data;
0625	4751	mov     a, data[0]
0626	43C5	addm    a, I2C[5]
				;313						
				;314						I2C.SUM += I2C.TxNum;
0627	4742	mov     a, I2C[2]
0628	43C1	addm    a, I2C[1]
0629	2E8D	jmp     L068D
				;315						
				;316						I2C.TxNum++;
				;317						if(I2C.TxNum >= I2C.SUM) 
				;318							I2C.TxNum = 0xFF;
				;319								
				;320					}else//srw=0:slave receive data for master
				;321						{	
				;322							_htx = 0;//_htx=0:
				L062A:
062A	3625	clr     HTX
				;323							_txak = 0;//_txak=0:slave enable ACK
062B	35A5	clr     TXAK
				;324							_acc = _simd;//dummy
062C	0726	mov     a, SIMD
062D	0085	mov     ACC, a
				;325							
				;326							I2C.RxNum = 0;//begin to conut
062E	5F43	clr     I2C[3]
				;327							I2C.TxNum = 0;
062F	5F42	clr     I2C[2]
				;328							I2C.SUM = 0;
0630	5F41	clr     I2C[1]
				;329							FLAG_I2C_End = FALSE;
0631	74C6	clr     FLAG[0].1
0632	2EE4	jmp     L06E4
				;330						} 
				;331				}
				;332				else//_haas=0:slave receive SLAVE_ADDR match,then communication data 
				;333				{	
				;334											  
				;335					if(_htx)//_htx=1:slave send data to master
				L0633:
0633	3A25	snz     HTX
0634	2E94	jmp     L0694
				;336					{								
				;337						if(_rxak)//_rxak=1:slave send data,then master NACK;
0635	3825	snz     RXAK
0636	2E3F	jmp     L063F
				;338						{							
				;339							_htx = 0;
0637	3625	clr     HTX
				;340							_txak = 0;	
0638	35A5	clr     TXAK
				;341							_acc = _simd;//dummy
0639	0726	mov     a, SIMD
063A	0085	mov     ACC, a
				;342	
				;343							I2C.WordAddr = 0x00;
063B	5F40	clr     I2C[0]
				;344							I2C.SUM = 0;
063C	5F41	clr     I2C[1]
				;345							I2C.TxNum = 0;
063D	5F42	clr     I2C[2]
063E	2EE4	jmp     L06E4
				;346						}
				;347						else//_rxak=1:slave send data,then master ACK
				;348						{				
				;349							//slave continue to send data to master (second and next data).							
				;350							switch(I2C.TxNum)
				L063F:
063F	4742	mov     a, I2C[2]
0640	40D2	mov     data[1], a
0641	4752	mov     a, data[1]
0642	0AA1	sub     a, A1H
0643	3D0A	sz      Z
0644	2E69	jmp     L0669
0645	0A01	sub     a, 1H
0646	3D0A	sz      Z
0647	2E6C	jmp     L066C
0648	4752	mov     a, data[1]
0649	0AB1	sub     a, B1H
064A	3D0A	sz      Z
064B	2E6F	jmp     L066F
064C	0A01	sub     a, 1H
064D	3D0A	sz      Z
064E	2E72	jmp     L0672
064F	4752	mov     a, data[1]
0650	0AB3	sub     a, B3H
0651	3D0A	sz      Z
0652	2E75	jmp     L0675
0653	0A01	sub     a, 1H
0654	3D0A	sz      Z
0655	2E78	jmp     L0678
0656	4752	mov     a, data[1]
0657	0AB5	sub     a, B5H
0658	3D0A	sz      Z
0659	2E7B	jmp     L067B
065A	0A01	sub     a, 1H
065B	3D0A	sz      Z
065C	2E7E	jmp     L067E
065D	4752	mov     a, data[1]
065E	0AB7	sub     a, B7H
065F	3D0A	sz      Z
0660	2E81	jmp     L0681
0661	0A3A	sub     a, 3AH
0662	3D0A	sz      Z
0663	2E84	jmp     L0684
0664	5652	siza    data[1]
0665	2E87	jmp     L0687
				;351							{
				;352			
				;353							//	case 0xA0 :data = GLOBE_VARIES[0];break;
				;354								case 0xA1 :data = GLOBE_VARIES[1];break;
				L0669:
0669	0761	mov     a, __sima[58]
066A	40D1	mov     data[0], a
066B	2E89	jmp     L0689
				;355								case 0xA2 :data = GLOBE_VARIES[2];break;
				L066C:
066C	0762	mov     a, __sima[59]
066D	40D1	mov     data[0], a
066E	2E89	jmp     L0689
				;356								
				;357							//	case 0xB0 :data = GLOBE_VARIES[3];;break;
				;358								case 0xB1 :data = GLOBE_VARIES[4];break;	
				L066F:
066F	0764	mov     a, __sima[61]
0670	40D1	mov     data[0], a
0671	2E89	jmp     L0689
				;359								case 0xB2 :data = GLOBE_VARIES[5];break; 
				L0672:
0672	0765	mov     a, __sima[62]
0673	40D1	mov     data[0], a
0674	2E89	jmp     L0689
				;360								case 0xB3 :data = GLOBE_VARIES[6];break;
				L0675:
0675	0766	mov     a, __sima[63]
0676	40D1	mov     data[0], a
0677	2E89	jmp     L0689
				;361								case 0xB4 :data = GLOBE_VARIES[7];break;
				L0678:
0678	0767	mov     a, __sima[64]
0679	40D1	mov     data[0], a
067A	2E89	jmp     L0689
				;362								case 0xB5 :data = GLOBE_VARIES[8];break;
				L067B:
067B	0768	mov     a, __sima[65]
067C	40D1	mov     data[0], a
067D	2E89	jmp     L0689
				;363								case 0xB6 :data = GLOBE_VARIES[9];break;
				L067E:
067E	0769	mov     a, __sima[66]
067F	40D1	mov     data[0], a
0680	2E89	jmp     L0689
				;364								case 0xB7 :data = GLOBE_VARIES[10];break;
				L0681:
0681	076A	mov     a, __sima[67]
0682	40D1	mov     data[0], a
0683	2E89	jmp     L0689
				;365	
				;366								#ifndef	 BS83B08A	
				;367								case 0xB8 :data = GLOBE_VARIES[11];break;
				;368								case 0xB9 :data = GLOBE_VARIES[12];break;	
				;369								case 0xBA :data = GLOBE_VARIES[13];break;	
				;370								case 0xBB :data = GLOBE_VARIES[14];break;
				;371								
				;372									#ifdef	 BS83B16A
				;373									case 0xBC :data = GLOBE_VARIES[15];break;
				;374									case 0xBD :data = GLOBE_VARIES[16];break;
				;375									case 0xBE :data = GLOBE_VARIES[17];break;
				;376									case 0xBF :data = GLOBE_VARIES[18];break;
				;377									#endif
				;378								
				;379							//	case 0xC0 :data = KEY_IO_SEL[0];break;
				;380								case 0xC1 :data = KEY_IO_SEL[1];break;
				;381								
				;382							//	case 0xD0 :data = MCU_INF[0];break;
				;383								case 0xD1 :data = MCU_INF[1];break;
				;384								
				;385							//	case 0xE0 :data = KEY_DATA[0];break;
				;386								case 0xE1 :data = KEY_DATA[1];break;
				;387							
				;388								#endif
				;389					
				;390							//	case 0xF0 :data =SYS_INF[0];break;
				;391								case 0xF1 :data = SYS_INF[1];break;	
				L0684:
0684	472F	mov     a, SYS_INF[1]
0685	40D1	mov     data[0], a
0686	2E89	jmp     L0689
				;392								
				;393								case 0xFF :data =~I2C.CheckSum_Buf;break;	
0666	4145	cpla    I2C[5]
0667	40D1	mov     data[0], a
0668	2E89	jmp     L0689
				;394									
				;395								default : data = 0xAA ;break;
				L0687:
0687	0FAA	mov     a, AAH
0688	40D1	mov     data[0], a
				;396							}	
				;397							
				;398							_simd = data;
				L0689:
0689	4751	mov     a, data[0]
068A	00A6	mov     SIMD, a
				;399							
				;400							I2C.CheckSum_Buf += data;
068B	4751	mov     a, data[0]
068C	43C5	addm    a, I2C[5]
				;401								
				;402							I2C.TxNum++;
				L068D:
068D	54C2	inc     I2C[2]
				;403							if(I2C.TxNum >= I2C.SUM) 
068E	4742	mov     a, I2C[2]
068F	4241	sub     a, I2C[1]
0690	380A	snz     C
0691	2EE4	jmp     L06E4
				;404								I2C.TxNum = 0xFF;
0692	5FC2	set     I2C[2]
0693	2EE4	jmp     L06E4
				;405		
				;406						}			
				;407					}
				;408					else//_htx=0:slave receive data for master
				;409					{//for slave send data to master
				;410						data = _simd;
				L0694:
0694	0726	mov     a, SIMD
0695	40D1	mov     data[0], a
				;411						_txak = 0;
0696	35A5	clr     TXAK
				;412						
				;413						if(I2C.RxNum < 1)
0697	50C3	sz      I2C[3]
0698	2ECF	jmp     L06CF
				;414						{
				;415							//for slave send data to master
				;416							//取地址
				;417							I2C.WordAddr = data&0xf0;					
0699	4751	mov     a, data[0]
069A	0EF0	and     a, F0H
069B	40C0	mov     I2C[0], a
				;418		
				;419						   	switch(I2C.WordAddr)
069C	4740	mov     a, I2C[0]
069D	40D2	mov     data[1], a
069E	4752	mov     a, data[1]
069F	0AB0	sub     a, B0H
06A0	3D0A	sz      Z
06A1	2EB5	jmp     L06B5
06A2	0A10	sub     a, 10H
06A3	3D0A	sz      Z
06A4	2EBA	jmp     L06BA
06A5	4752	mov     a, data[1]
06A6	0AD0	sub     a, D0H
06A7	3D0A	sz      Z
06A8	2EBF	jmp     L06BF
06A9	0A10	sub     a, 10H
06AA	3D0A	sz      Z
06AB	2EC4	jmp     L06C4
06AC	4752	mov     a, data[1]
06AD	0AF0	sub     a, F0H
06AE	390A	snz     Z
06AF	2EC9	jmp     L06C9
				;420							{	
				;421						//		case 0xA0 :I2C.SUM = IC_PAGE_SIZS[0];I2C.TxNum = IC_PAGE_HEAD[0];break;
				;422								case 0xB0 :I2C.SUM = IC_PAGE_SIZS[1];I2C.TxNum = IC_PAGE_HEAD[1];break;
				L06B5:
06B5	0F0C	mov     a, CH
06B6	40C1	mov     I2C[1], a
06B7	0FB0	mov     a, B0H
06B8	40C2	mov     I2C[2], a
06B9	2ECD	jmp     L06CD
				;423								case 0xC0 :I2C.SUM = IC_PAGE_SIZS[2];I2C.TxNum = IC_PAGE_HEAD[2];break;
				L06BA:
06BA	0F02	mov     a, 2H
06BB	40C1	mov     I2C[1], a
06BC	0FC0	mov     a, C0H
06BD	40C2	mov     I2C[2], a
06BE	2ECD	jmp     L06CD
				;424								case 0xD0 :I2C.SUM = IC_PAGE_SIZS[3];I2C.TxNum = IC_PAGE_HEAD[3];break;
				L06BF:
06BF	0F02	mov     a, 2H
06C0	40C1	mov     I2C[1], a
06C1	0FD0	mov     a, D0H
06C2	40C2	mov     I2C[2], a
06C3	2ECD	jmp     L06CD
				;425								case 0xE0 :I2C.SUM = IC_PAGE_SIZS[4];I2C.TxNum = IC_PAGE_HEAD[4];break;
				L06C4:
06C4	0F02	mov     a, 2H
06C5	40C1	mov     I2C[1], a
06C6	0FE0	mov     a, E0H
06C7	40C2	mov     I2C[2], a
06C8	2ECD	jmp     L06CD
				;426								case 0xF0 :I2C.SUM = IC_PAGE_SIZS[5];I2C.TxNum = IC_PAGE_HEAD[5];break;
06B0	0F02	mov     a, 2H
06B1	40C1	mov     I2C[1], a
06B2	0FF0	mov     a, F0H
06B3	40C2	mov     I2C[2], a
06B4	2ECD	jmp     L06CD
				;427								default   :I2C.SUM = IC_PAGE_SIZS[0];I2C.TxNum = IC_PAGE_HEAD[0];break;
				L06C9:
06C9	0F03	mov     a, 3H
06CA	40C1	mov     I2C[1], a
06CB	0FA0	mov     a, A0H
06CC	40C2	mov     I2C[2], a
				;428							}
				;429							I2C.CheckSum_Buf = 0;
				L06CD:
06CD	5F45	clr     I2C[5]
06CE	2EE3	jmp     L06E3
				;430							I2C.RxNum++;
				;431	
				;432						}
				;433						else if(I2C.RxNum <= I2C.SUM)
				L06CF:
06CF	4741	mov     a, I2C[1]
06D0	4243	sub     a, I2C[3]
06D1	380A	snz     C
06D2	2EE0	jmp     L06E0
				;434							 { 
				;435								I2C_Data[I2C.RxNum - 1] = data;
06D3	0FB3	mov     a, B3H
06D4	4343	add     a, I2C[3]
06D5	0083	mov     MP1, a
06D6	0F00	mov     a, 0H
06D7	1F01	clr     MP0
06D8	1381	adcm    a, MP0
06D9	0701	mov     a, MP0
06DA	0084	mov     BP, a
06DB	4751	mov     a, data[0]
06DC	0082	mov     [02H], a
				;436								I2C.CheckSum_Buf += data;
06DD	4751	mov     a, data[0]
06DE	43C5	addm    a, I2C[5]
06DF	2EE3	jmp     L06E3
				;437								I2C.RxNum++;
				;438							 }
				;439							 else 
				;440							 {
				;441							 	I2C.CheckSum = data;
				L06E0:
06E0	4751	mov     a, data[0]
06E1	40C4	mov     I2C[4], a
				;442							 	FLAG_I2C_End = TRUE;
06E2	70C6	set     FLAG[0].1
				;443							 	I2C.RxNum++;
				L06E3:
06E3	54C3	inc     I2C[3]
				L06E4:
06E4	474D	mov     a, r210
06E5	0084	mov     BP, a
06E6	474E	mov     a, r310
06E7	008A	mov     STATUS, a
06E8	474F	mov     a, r410
06E9	0083	mov     MP1, a
06EA	4750	mov     a, r510
06EB	0081	mov     MP0, a
06EC	474C	mov     a, r110
06ED	0004	reti
06EE	1483	inc     MP1
				L06EF:
06EF	3F81	sz      MP0.7
06F0	2EF5	jmp     L06F5
06F1	0701	mov     a, MP0
06F2	0084	mov     BP, a
06F3	0702	mov     a, [02H]
06F4	0003	ret
				L06F5:
06F5	1B01	rrca    MP0
06F6	0E3F	and     a, 3FH
06F7	0089	mov     TBHP, a
06F8	1B03	rrca    MP1
06F9	0087	mov     TBLP, a
06FA	1D05	tabrd   ACC
06FB	3C0A	sz      C
06FC	0708	mov     a, TBLH
06FD	0003	ret
				;444							 }
				;445							 
				;446							
				;447					}		
				;448				}
				;449			}	
				;450	}
				;451	
				;452	
				;453	
				;454	
				;455	//void __attribute((interrupt(0x0c))) ISR_tmr0 (void)
				;456	//{		
				;457	////	LED1 = ~LED1;		
				;458	//			
				;459	//	//----------------------------------------------------
				;460	//	if(Cnt20ms > 0)//20ms 计数器
				;461	//	{				
				;462	//			Cnt20ms--;
				;463	//	}
				;464	//	else
				;465	//	{
				;466	//			Cnt20ms = 19;	
				;467	//			Flag20ms = 1;			//20ms 标志 26MS
				;468	//	}	
				;469	//}
				;470	
				;471	
				data .SECTION 'DATA'
				__acc DB DUP (?) ; __acc
				__intc0 DB DUP (?) ; __intc0
				__intc1 DB DUP (?) ; __intc1
				__pa DB DUP (?) ; __pa
				__pac DB DUP (?) ; __pac
				__papu DB DUP (?) ; __papu
				__pawu DB DUP (?) ; __pawu
				__wdtc DB DUP (?) ; __wdtc
				__i2ctoc DB DUP (?) ; __i2ctoc
				__simc0 DB DUP (?) ; __simc0
				__simc1 DB DUP (?) ; __simc1
				__simd DB DUP (?) ; __simd
				__sima DB DUP (?) ; __sima
				SYS_INF DB DUP (?) ; SYS_INF
				MCU_INF DB DUP (?) ; MCU_INF
				I2C_Data DB DUP (?) ; I2C_Data
				I2C DB DUP (?) ; I2C
				FLAG DB DUP (?) ; FLAG
				POR_ID DB DUP (?) ; POR_ID
				ra DB DUP (?)
				rb DB DUP (?)
				rc DB DUP (?)
				r110 DB DUP (?)
				r210 DB DUP (?)
				r310 DB DUP (?)
				r410 DB DUP (?)
				r510 DB DUP (?)
				data DB DUP (?) ; data
				_DATA_LIST_UPDATA_2 DB DUP (?)
